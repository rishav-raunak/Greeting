<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diwali & Chhath Puja Greetings</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a festive look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tiro+Devanagari+Hindi:ital@0;1&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Meta tags for social sharing -->
    <meta property="og:title" id="og-title" content="Festive Greetings for Diwali & Chhath Puja!">
    <meta property="og:description" id="og-description" content="Create and send beautiful, animated greeting cards to your friends and family.">
    <meta property="og:image" id="og-image" content="https://cdn.pixabay.com/photo/2018/11/22/16/39/diwali-3832321_1280.jpg">
    <meta property="og:url" id="og-url" content="https://soulfullines.netlify.app">
    <meta name="twitter:card" content="summary_large_image">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
        }
        .hindi-font {
            font-family: 'Tiro Devanagari Hindi', serif;
        }
        #fireworks-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(180deg, #0f172a 0%, #334155 100%);
        }
        .card-link {
            display: block;
            text-decoration: none;
            color: inherit;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-link:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        
        /* Twinkling Star Animation */
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background-color: white;
            border-radius: 50%;
            box-shadow: 0 0 5px white;
            animation: twinkle 3s infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* CSS Animated Diya */
        .diya-container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 1rem;
        }
        .diya {
            position: relative;
            display: flex;
            justify-content: center;
        }
        .diya .body {
            width: 80px;
            height: 40px;
            background: linear-gradient(to right, #fca5a5, #fb923c);
            border-radius: 0 0 50% 50%;
            border: 2px solid #f97316;
        }
        .diya .flame {
            position: absolute;
            bottom: 15px;
            width: 20px;
            height: 40px;
            background-color: #fcd34d;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            transform-origin: bottom center;
            animation: flicker 1.5s ease-in-out infinite;
        }

        @keyframes flicker {
            0%, 100% {
                transform: scaleY(1) scaleX(1);
                opacity: 1;
            }
            50% {
                transform: scaleY(0.95) scaleX(1.05);
                opacity: 0.7;
            }
        }
    </style>
</head>
<body class="bg-slate-900 text-white">

    <!-- Canvas for background fireworks animation -->
    <canvas id="fireworks-canvas"></canvas>

    <!-- Main Container -->
    <div id="main-container" class="container mx-auto px-4 py-8 sm:py-16">
        
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-6xl font-bold text-amber-400 hindi-font">‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•Ä ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç</h1>
            <p class="text-slate-300 mt-2 text-lg">Choose a card to create and share your greeting.</p>
        </header>

        <!-- Greeting Card Grid -->
        <section id="card-selection-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-8">
            <!-- Card 1: Diwali -->
            <a href="#" class="card-link" data-type="diwali" data-title="Happy Diwali" data-greeting="‡§∂‡•Å‡§≠ ‡§¶‡•Ä‡§™‡§æ‡§µ‡§≤‡•Ä" data-card-id="1">
                <div class="card-content h-[400px] max-w-sm w-full mx-auto rounded-xl shadow-lg flex flex-col justify-between p-6 bg-gradient-to-br from-amber-500/20 via-red-500/20 to-purple-600/20 backdrop-blur-sm border border-white/10">
                    <div class="text-center">
                        <h2 class="text-4xl font-bold text-amber-300 hindi-font">‡§∂‡•Å‡§≠ ‡§¶‡•Ä‡§™‡§æ‡§µ‡§≤‡•Ä</h2>
                        <div class="w-36 h-36 mx-auto my-8 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-amber-300 opacity-80"><path d="M14 4c-2.14 2.86-3.21 4.29-4 8 1.43-1.43 2.86-2.14 4.29-2.14 2.14 0 4.29-1.43 4.29-4.29H14Z"/><path d="M12.92 14.5A8.42 8.42 0 0 1 12 16a8.42 8.42 0 0 1-1-1.5"/><path d="M6 18a8.42 8.42 0 0 0 12 0"/><path d="M2 18a4 4 0 0 1 4-4h12a4 4 0 0 1 4 4"/></svg>
                        </div>
                    </div>
                    <div class="h-[50px] flex items-center justify-center text-center bg-black/30 rounded-lg">
                        <p class="text-slate-200">Diwali Greeting</p>
                    </div>
                </div>
            </a>
            <!-- Card 2: Diwali -->
             <a href="#" class="card-link" data-type="diwali" data-title="Happy Diwali" data-greeting="‡§¶‡•Ä‡§™‡§æ‡§µ‡§≤‡•Ä ‡§ï‡•Ä ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç" data-card-id="2">
                <div class="card-content h-[400px] max-w-sm w-full mx-auto rounded-xl shadow-lg flex flex-col justify-between p-6 bg-gradient-to-br from-yellow-400/20 via-orange-500/20 to-rose-600/20 backdrop-blur-sm border border-white/10">
                    <div class="text-center">
                        <h2 class="text-4xl font-bold text-yellow-200 hindi-font">‡§¶‡•Ä‡§™‡§æ‡§µ‡§≤‡•Ä ‡§ï‡•Ä ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç</h2>
                        <div class="w-36 h-36 mx-auto my-8 flex items-center justify-center">
                           <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-200 opacity-80"><path d="M12 2v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="M2 12h2"/><path d="m4.93 19.07 1.41-1.41"/><path d="M12 22v-2"/><path d="m19.07 19.07-1.41-1.41"/><path d="M22 12h-2"/><path d="m19.07 4.93-1.41 1.41"/><path d="M12 6a6 6 0 1 0 6 6c0-4-6-6-6-6Z"/></svg>
                        </div>
                    </div>
                    <div class="h-[50px] flex items-center justify-center text-center bg-black/30 rounded-lg">
                        <p class="text-slate-200">Festival of Lights</p>
                    </div>
                </div>
            </a>
            <!-- Card 3: Diwali -->
            <a href="#" class="card-link" data-type="diwali" data-title="Happy Diwali" data-greeting="‡§∞‡•ã‡§∂‡§®‡•Ä ‡§ï‡§æ ‡§™‡§∞‡•ç‡§µ" data-card-id="3">
                <div class="card-content h-[400px] max-w-sm w-full mx-auto rounded-xl shadow-lg flex flex-col justify-between p-6 bg-gradient-to-br from-sky-400/20 via-indigo-500/20 to-fuchsia-600/20 backdrop-blur-sm border border-white/10">
                    <div class="text-center">
                        <h2 class="text-4xl font-bold text-sky-200 hindi-font">‡§∞‡•ã‡§∂‡§®‡•Ä ‡§ï‡§æ ‡§™‡§∞‡•ç‡§µ</h2>
                         <div class="w-36 h-36 mx-auto my-8 flex items-center justify-center">
                           <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-sky-200 opacity-80"><path d="M12 3v2.35l.8.4a4 4 0 0 0 4.4 0l.8-.4V3"/><path d="M12 21v-2.35l-.8-.4a4 4 0 0 0-4.4 0l-.8.4v2.35"/><path d="M3 12h2.35l.4.8a4 4 0 0 0 0 4.4l-.4.8H3"/><path d="M21 12h-2.35l-.4-.8a4 4 0 0 0 0-4.4l.4-.8H21"/></svg>
                         </div>
                    </div>
                    <div class="h-[50px] flex items-center justify-center text-center bg-black/30 rounded-lg">
                        <p class="text-slate-200">Shimmering Diwali</p>
                    </div>
                </div>
            </a>
            <!-- Card 4: Chhath Puja -->
            <a href="#" class="card-link" data-type="chhath" data-title="Happy Chhath Puja" data-greeting="‡§õ‡§† ‡§™‡•Ç‡§ú‡§æ ‡§ï‡•Ä ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç" data-card-id="4">
                <div class="card-content h-[400px] max-w-sm w-full mx-auto rounded-xl shadow-lg flex flex-col justify-between p-6 bg-gradient-to-br from-orange-400/20 via-amber-500/20 to-yellow-600/20 backdrop-blur-sm border border-white/10">
                    <div class="text-center">
                        <h2 class="text-4xl font-bold text-orange-200 hindi-font">‡§õ‡§† ‡§™‡•Ç‡§ú‡§æ ‡§ï‡•Ä ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç</h2>
                        <div class="w-36 h-36 mx-auto my-8 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-orange-200 opacity-80"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
                        </div>
                    </div>
                    <div class="h-[50px] flex items-center justify-center text-center bg-black/30 rounded-lg">
                        <p class="text-slate-200">Chhath Puja Greeting</p>
                    </div>
                </div>
            </a>
            <!-- Card 5: Chhath Puja -->
            <a href="#" class="card-link" data-type="chhath" data-title="Happy Chhath Puja" data-greeting="‡§ú‡§Ø ‡§õ‡§†‡•Ä ‡§Æ‡•à‡§Ø‡§æ" data-card-id="5">
                <div class="card-content h-[400px] max-w-sm w-full mx-auto rounded-xl shadow-lg flex flex-col justify-between p-6 bg-gradient-to-br from-red-500/20 via-yellow-400/20 to-orange-500/20 backdrop-blur-sm border border-white/10">
                    <div class="text-center">
                        <h2 class="text-4xl font-bold text-red-200 hindi-font">‡§ú‡§Ø ‡§õ‡§†‡•Ä ‡§Æ‡•à‡§Ø‡§æ</h2>
                        <div class="w-36 h-36 mx-auto my-8 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-red-200 opacity-80"><path d="M18 10h-1.26a2 2 0 0 0-1.99 2v4a2 2 0 0 0 2 2h2.26"/><path d="M6 10H4.74a2 2 0 0 0-1.99 2v4a2 2 0 0 0 2 2h2.26"/><path d="M12 10v4h0a2 2 0 0 1-2-2v0a2 2 0 0 1 2-2h0Z"/><path d="M12 10a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2z"/><path d="m14 10-3-3-3 3"/></svg>
                        </div>
                    </div>
                    <div class="h-[50px] flex items-center justify-center text-center bg-black/30 rounded-lg">
                        <p class="text-slate-200">Wishes for Chhath</p>
                    </div>
                </div>
            </a>
        </section>
    </div>

    <!-- Full Screen Greeting View -->
    <div id="greeting-view-container" class="hidden">
        <!-- Visuals Section -->
        <section id="visuals-section" class="h-[500px] w-full flex flex-col items-center justify-center p-4 relative text-center overflow-hidden">
             <!-- Star Container -->
            <div id="stars-container" class="absolute inset-0"></div>

             <!-- Decorative elements -->
            <div class="absolute top-4 left-4 text-4xl opacity-70 animate-pulse">‚ú®</div>
            <div class="absolute top-10 right-10 text-5xl opacity-70 animate-pulse" style="animation-delay: 0.5s;">üéá</div>
            <div class="absolute bottom-28 right-4 text-4xl opacity-70 animate-pulse" style="animation-delay: 1s;">üß®</div>
            <div class="absolute bottom-32 left-10 text-5xl opacity-70 animate-pulse" style="animation-delay: 1.5s;">üéÜ</div>

            <!-- Main Greeting -->
            <h1 id="greeting-title" class="text-6xl md:text-8xl font-bold text-amber-300 hindi-font z-10" style="text-shadow: 0 0 15px rgba(252, 211, 77, 0.7);"></h1>

            <!-- Diya Border at the bottom -->
            <div class="absolute bottom-0 left-0 w-full flex justify-center items-end p-2 space-x-2 md:space-x-4">
                 <div class="diya-container">
                    <div class="diya" style="transform: scale(0.8);">
                        <div class="body"></div>
                        <div class="flame"></div>
                    </div>
                     <div class="diya" style="transform: scaleX(-1) scale(0.9);">
                        <div class="body"></div>
                        <div class="flame"></div>
                    </div>
                    <div class="diya" style="transform: scale(1.1);">
                        <div class="body"></div>
                        <div class="flame"></div>
                    </div>
                    <div class="diya" style="transform: scale(1.1);">
                        <div class="body"></div>
                        <div class="flame"></div>
                    </div>
                     <div class="diya" style="transform: scaleX(-1) scale(0.9);">
                        <div class="body"></div>
                        <div class="flame"></div>
                    </div>
                    <div class="diya" style="transform: scale(0.8);">
                        <div class="body"></div>
                        <div class="flame"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Interaction Section -->
        <section id="interaction-section" class="w-full min-h-[600px] py-16 px-4 bg-slate-900/70 backdrop-blur-sm flex flex-col items-center justify-start">
             <div class="w-full max-w-lg text-center">
                <p id="greeting-by-line" class="text-3xl md:text-4xl text-slate-200 mb-4"></p>
                <p id="custom-message-display" class="text-xl text-slate-300 mb-8 px-4 font-bold"></p>
                
                <!-- Form for creating a new greeting -->
                <div id="create-greeting-section" class="bg-white/10 p-6 rounded-xl">
                     <p class="text-lg mb-4">Apna naam aur message likh kar greeting banayein:</p>
                    <input type="text" id="name-input" placeholder="Aapka Naam" class="w-full px-4 py-2 rounded-lg bg-slate-800 border border-slate-600 focus:ring-2 focus:ring-amber-400 focus:outline-none text-white text-center text-lg">
                    <textarea id="message-input" placeholder="Aapka pyara sa message yahan likhein..." class="mt-4 w-full px-4 py-2 rounded-lg bg-slate-800 border border-slate-600 focus:ring-2 focus:ring-amber-400 focus:outline-none text-white text-center text-lg h-24 resize-none"></textarea>
                    <button id="generate-link-btn" class="mt-4 w-full bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold py-3 px-6 rounded-lg transition-colors">
                         ‡§≠‡•á‡§ú‡•á‡§Ç (Send)
                    </button>
                </div>

                <!-- Section to show the generated link and share buttons -->
                <div id="share-section" class="hidden mt-8 bg-white/10 p-6 rounded-xl max-w-lg mx-auto">
                    <p class="mb-2">Aapki personalized link taiyaar hai!</p>
                    <input type="text" id="generated-link-input" readonly class="w-full p-2 rounded bg-slate-800 border border-slate-600 text-center text-amber-300">
                    <div class="flex justify-center items-center gap-4 mt-4">
                        <a id="share-whatsapp" href="#" target="_blank" class="p-3 bg-green-500 rounded-full hover:bg-green-600 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99 0-3.903-.52-5.586-1.456l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.886-.001 2.267.655 4.398 1.803 6.12l-1.34 4.895 5.023-1.315z"/></svg>
                        </a>
                        <a id="share-twitter" href="#" target="_blank" class="p-3 bg-sky-500 rounded-full hover:bg-sky-600 transition-colors">
                             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                        </a>
                        <button id="copy-link-btn" class="p-3 bg-slate-500 rounded-full hover:bg-slate-600 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        </button>
                    </div>
                </div>
                
                <!-- Button for users who received a greeting to create their own -->
                <div id="create-own-greeting-section" class="hidden mt-12">
                     <button id="back-to-home-btn" class="bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold py-3 px-6 rounded-lg transition-colors">
                        ‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞ ‡§≠‡•á‡§ú‡•á‡§Ç(Greet Kare)
                    </button>
                </div>
            </div>
        </section>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- Fireworks Animation ---
        const canvas = document.getElementById('fireworks-canvas');
        const ctx = canvas.getContext('2d');
        let fireworks = [];
        let particles = [];
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        function Firework(sx, sy, tx, ty) {
            this.x = sx; this.y = sy; this.sx = sx; this.sy = sy; this.tx = tx; this.ty = ty;
            this.distanceToTarget = Math.sqrt(Math.pow(tx - sx, 2) + Math.pow(ty - sy, 2));
            this.distanceTraveled = 0; this.coordinates = []; this.coordinateCount = 3;
            while (this.coordinateCount--) { this.coordinates.push([this.x, this.y]); }
            this.angle = Math.atan2(ty - sy, tx - sx); this.speed = 2; this.acceleration = 1.05;
            this.brightness = Math.random() * 50 + 50; this.targetRadius = 1;
        }
        Firework.prototype.update = function(index) {
            this.coordinates.pop(); this.coordinates.unshift([this.x, this.y]);
            if (this.targetRadius < 8) { this.targetRadius += 0.3; } else { this.targetRadius = 1; }
            this.speed *= this.acceleration;
            let vx = Math.cos(this.angle) * this.speed; let vy = Math.sin(this.angle) * this.speed;
            this.distanceTraveled = Math.sqrt(Math.pow(this.x - this.sx, 2) + Math.pow(this.y - this.sy, 2));
            if (this.distanceTraveled >= this.distanceToTarget) {
                createParticles(this.tx, this.ty); fireworks.splice(index, 1);
            } else { this.x += vx; this.y += vy; }
        };
        Firework.prototype.draw = function() {
            ctx.beginPath();
            ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
            ctx.lineTo(this.x, this.y);
            ctx.strokeStyle = 'hsl(' + Math.random() * 360 + ', 100%, ' + this.brightness + '%)';
            ctx.stroke();
        };

        function Particle(x, y) {
            this.x = x; this.y = y; this.coordinates = []; this.coordinateCount = 5;
            while (this.coordinateCount--) { this.coordinates.push([this.x, this.y]); }
            this.angle = Math.random() * Math.PI * 2; this.speed = Math.random() * 10 + 1;
            this.friction = 0.95; this.gravity = 1; this.hue = Math.random() * 360;
            this.brightness = Math.random() * 50 + 50; this.alpha = 1; this.decay = Math.random() * 0.03 + 0.015;
        }
        Particle.prototype.update = function(index) {
            this.coordinates.pop(); this.coordinates.unshift([this.x, this.y]);
            this.speed *= this.friction; this.x += Math.cos(this.angle) * this.speed;
            this.y += Math.sin(this.angle) * this.speed + this.gravity;
            this.alpha -= this.decay;
            if (this.alpha <= this.decay) { particles.splice(index, 1); }
        };
        Particle.prototype.draw = function() {
            ctx.beginPath();
            ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
            ctx.lineTo(this.x, this.y);
            ctx.strokeStyle = 'hsla(' + this.hue + ', 100%, ' + this.brightness + '%, ' + this.alpha + ')';
            ctx.stroke();
        };

        function createParticles(x, y) {
            let particleCount = 30;
            while (particleCount--) { particles.push(new Particle(x, y)); }
        }

        function loop() {
            requestAnimationFrame(loop);
            ctx.globalCompositeOperation = 'destination-out';
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.globalCompositeOperation = 'lighter';
            let i = fireworks.length; while (i--) { fireworks[i].draw(); fireworks[i].update(i); }
            let j = particles.length; while (j--) { particles[j].draw(); particles[j].update(j); }
            if (Math.random() < 0.1) { // Increased fireworks frequency
                fireworks.push(new Firework(canvas.width / 2, canvas.height, Math.random() * canvas.width, Math.random() * canvas.height / 2));
            }
        }
        window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
        loop();

        // --- Star Generation ---
        function createStars() {
            const container = document.getElementById('stars-container');
            if (!container) return;
            container.innerHTML = ''; // Clear existing stars
            const starCount = 200; // Double the stars!
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                star.style.top = `${Math.random() * 100}%`;
                star.style.left = `${Math.random() * 100}%`;
                const randomDelay = Math.random() * 3;
                const randomDuration = Math.random() * 2 + 2; // 2s to 4s
                star.style.animationDelay = `${randomDelay}s`;
                star.style.animationDuration = `${randomDuration}s`;
                container.appendChild(star);
            }
        }

        // --- Greeting Card Logic ---
        const mainContainer = document.getElementById('main-container');
        const cardLinks = document.querySelectorAll('.card-link');
        const greetingViewContainer = document.getElementById('greeting-view-container');
        const greetingTitleEl = document.getElementById('greeting-title');
        const greetingByLineEl = document.getElementById('greeting-by-line');
        const customMessageDisplay = document.getElementById('custom-message-display');
        const createGreetingSection = document.getElementById('create-greeting-section');
        const shareSection = document.getElementById('share-section');
        const createOwnGreetingSection = document.getElementById('create-own-greeting-section');
        const nameInput = document.getElementById('name-input');
        const messageInput = document.getElementById('message-input');
        const generateLinkBtn = document.getElementById('generate-link-btn');
        const generatedLinkInput = document.getElementById('generated-link-input');
        const copyLinkBtn = document.getElementById('copy-link-btn');
        const backToHomeBtn = document.getElementById('back-to-home-btn');

        // Meta Tags
        const ogTitle = document.getElementById('og-title');
        const ogDescription = document.getElementById('og-description');
        const ogImage = document.getElementById('og-image');
        const ogUrl = document.getElementById('og-url');


        let currentCardData = {};

        // Function to show the modal
        const showGreetingView = (cardData, name = "", message = "") => {
            currentCardData = cardData;
            mainContainer.classList.add('hidden');
            greetingViewContainer.classList.remove('hidden');
            createStars(); // Generate stars when view is shown
            
            greetingTitleEl.textContent = cardData.greeting;
            if (name) {
                greetingByLineEl.textContent = `from ${name}`;
                customMessageDisplay.textContent = `"${message}"`;
                createGreetingSection.classList.add('hidden');
                shareSection.classList.add('hidden');
                createOwnGreetingSection.classList.remove('hidden');
            } else {
                greetingByLineEl.textContent = 'Create a greeting for your loved ones';
                customMessageDisplay.textContent = '';
                createGreetingSection.classList.remove('hidden');
                shareSection.classList.add('hidden');
                createOwnGreetingSection.classList.add('hidden');
                nameInput.value = '';
                messageInput.value = '';
            }
        };

        // Event listener for all cards
        cardLinks.forEach(card => {
            card.addEventListener('click', (e) => {
                e.preventDefault();
                const cardData = {
                    type: card.dataset.type,
                    title: card.dataset.title,
                    greeting: card.dataset.greeting,
                    cardId: card.dataset.cardId
                };
                showGreetingView(cardData);
            });
        });

        // Update greeting text as user types their name
        nameInput.addEventListener('input', () => {
            const name = nameInput.value.trim();
            greetingByLineEl.textContent = name ? `from ${name}` : 'Create a greeting for your loved ones';
            shareSection.classList.add('hidden');
        });

        // Generate and display shareable link
        generateLinkBtn.addEventListener('click', () => {
            const name = nameInput.value.trim();
            const message = messageInput.value.trim();

            if (!name) {
                greetingByLineEl.textContent = 'Please enter your name first!';
                greetingByLineEl.classList.add('text-red-400');
                setTimeout(() => {
                    greetingByLineEl.textContent = 'Create a greeting for your loved ones';
                    greetingByLineEl.classList.remove('text-red-400');
                }, 3000);
                return;
            }

            const baseUrl = window.location.origin + window.location.pathname;
            const queryParams = new URLSearchParams({ 
                name: btoa(name), 
                card: currentCardData.cardId,
                msg: btoa(message || `Wishing you a very ${currentCardData.title}!`) // Add message
            });
            const finalUrl = `${baseUrl}?${queryParams.toString()}`;

            generatedLinkInput.value = finalUrl;
            shareSection.classList.remove('hidden');

            const shareText = encodeURIComponent(`${message || `Wishing you a very ${currentCardData.title}!`}\n\n‚ú® Greeting from ${name}:\n${finalUrl}`);
            document.getElementById('share-whatsapp').href = `https://api.whatsapp.com/send?text=${shareText}`;
            document.getElementById('share-twitter').href = `https://twitter.com/intent/tweet?text=${shareText}`;
        });

        // Copy link to clipboard
        copyLinkBtn.addEventListener('click', () => {
            generatedLinkInput.select();
            document.execCommand('copy');
            copyLinkBtn.innerHTML = 'Copied!';
            setTimeout(() => {
                copyLinkBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`;
            }, 2000);
        });
        
        // Back to home button
        backToHomeBtn.addEventListener('click', () => {
            window.location.href = window.location.origin + window.location.pathname;
        });

        // Check for URL params on page load
        const urlParams = new URLSearchParams(window.location.search);
        const nameParam = urlParams.get('name');
        const cardIdParam = urlParams.get('card');
        const msgParam = urlParams.get('msg'); // Get message param

        if (nameParam && cardIdParam) {
            try {
                const decodedName = atob(nameParam);
                const decodedMsg = msgParam ? atob(msgParam) : "Wishes you a very happy and prosperous festival!";
                const targetCard = document.querySelector(`.card-link[data-card-id='${cardIdParam}']`);
                if (targetCard) {
                    const cardData = {
                        type: targetCard.dataset.type,
                        title: targetCard.dataset.title,
                        greeting: targetCard.dataset.greeting,
                        cardId: targetCard.dataset.cardId
                    };
                    showGreetingView(cardData, decodedName, decodedMsg);

                    // Dynamically update meta tags for rich sharing preview
                    ogTitle.setAttribute('content', `${cardData.title} from ${decodedName}!`);
                    ogDescription.setAttribute('content', decodedMsg);
                    let imageUrl = cardData.type === 'diwali'
                        ? 'https://i.ibb.co/wJmYVzC/diwali-greeting-image.png'
                        : 'https://i.ibb.co/N2z5W3B/chhath-puja-greeting.png';
                    ogImage.setAttribute('content', imageUrl);
                    ogUrl.setAttribute('content', window.location.href);

                }
            } catch (e) {
                console.error("Failed to decode params from URL:", e);
            }
        }
    });
    </script>
</body>
</html>


